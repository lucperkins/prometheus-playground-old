# nginx sandbox

In this sandbox, [nginx](https://nginx.org) acts as a reverse proxy for Prometheus. nginx enforces both [TLS encryption](https://prometheus.io/docs/guides/tls-encryption) and [basic auth](https://prometheus.io/docs/guides/basic-auth).

> To access Prometheus in this sandbox, the proper username/password combo is `admin`/`password`.

## Usage

To start the sandbox:

```bash
# In the foreground
make run # docker-compose up --build

# In detached mode
make run-detached # docker-compose up --build --detach
```

This will start up an `nginx` container and a `prometheus` container. The `nginx` container is available on `localhost` port 443 but the example will only work if you map `localhost` to `example.com`. You can do so by modifying your `/etc/hosts` file to include a line like this:

```conf
127.0.0.1     localhost example.com
```

As nginx enforces both TLS encryption and basic auth, this will result in a self-signed certificate error:

```bash
curl https://example.com/prometheus/graph
```

If you disable cert checking using `--insecure`/`-k` you'll get a `401 Unauthorized` error:

```bash
curl -ik https://example.com/prometheus/graph
```

You'll need to supply the username and password to access Prometheus through the proxy:

```bash
curl -ik -u admin:password https://example.com/prometheus/graph
```

Open up `https://admin:password@example.com/prometheus/graph` to access the Prometheus [expression browser](https://prometheus.io/docs/visualization/browser).

## Assets

Folder | Assets
:------|:------
[`certs`](./certs) | An SSL cert and key generated by [OpenSSL](https://www.openssl.org/)
[`nginx`](./nginx) | An [`nginx.conf`](./nginx/nginx.conf) configuration file and [`.htpasswd`](./nginx/.htpasswd) password file
[`prometheus`](./prometheus) | A [`prometheus.yml`](./prometheus/prometheus.yml) configuration file for Prometheus